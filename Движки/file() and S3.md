# Теория
Начнем с **file()** - управляет данными в одном файле на диске в указанном формате. Это значит что он не хранит файл у себя, а каждый раз ходит в файловую систему чтобы прочитать. Данный движок полезен когда нужно сохранить какую то конфиденциальную информацию на диске и время от времени к ней обращаться. Не всегда для данного движка требуется создавать отдельную таблицу через CREATE TABLE , иногда можно просто обратиться через обычную функцию например вот так 
``sql
SELECT * 
FROM file('test.csv', 'CSV', '...схема данных...')
``
Теперь применим функцию для чтения такого файла:

``sql
SELECT * 
FROM file('titanic.csv', 'CSV', 'PassengerId Int64, Survived Int8, Pclass Int16, Name String, Sex String, Age String, SibSp  Int8, Parch Int32, Ticket String, Fare String, Cabin  String, Embarked  String')
``

Другой движок тоже позволяет читать из файловой системы, но только S3, это крайне полезный движок так как дает возможность организовать в связке с ClickHouse холодное и горячее хранение данных.

Ремарка про холодное и горячее хранение:

*Это подход к организации хранилища в котором часть данных лежит в быстром доступе, к ним всегда можно дотянуться, а другая часть обычно доступна с большой задержкой. Данные делятся по времени, и очень старые убираются в холодное хранение, так как доступ к ним нужен очень редко и не требуется быстрая производительность.*

*Горячее хранение данных (hot storage) - это хранение данных, которые используются часто или имеют высокую важность для бизнеса, и требуют быстрого доступа и высокой производительности. Обычно горячее хранение представляет собой технологические решения с высокой стоимостью, высокой скоростью и низкой емкостью хранения. Примерами горячего хранения данных являются например ClickHouse, Vertica*

*Холодное хранение данных (cold storage) - это хранение данных, которые используются редко, или не нуждаются в быстром доступе. Обычно холодное хранение является более дешевым, но менее производительным, чем горячее хранение, и используется для хранения данных, которые не используются в течение длительного времени. Примерами холодного хранения данных являются например Amazon S3, Google Cloud Storage и т.д.*

Пример использования:

``sql
CREATE TABLE s3_table (
   name String, 
   value UInt32
) 
 ENGINE=S3('PATH TO FILE', 'CSV', 'gzip')
 SETTINGS input_format_with_names_use_header = 0;
``

Создав такую таблицу и написав в ней запрос, ClickHouse будет каждый раз обращаться к ней для чтения. Будьте аккуратны с этим и не храните гигантские файлы который ClickHouse не сможет загрузить.

Чтобы авторизации через логин/пароль для доступа к файлам можно использовать следующий синтаксис:

``s3(path, aws_access_key_id, aws_secret_access_key, ...остальные параметры)``


Данный синтаксис подразумевает доступ через  ключи доступа aws_access_key_id, aws_secret_access_key которые создаются отдельно, однако можно воспользоваться логином и паролем  через такой синтаксис.

``s3('http://...', 'login', 'password', ... остальные параметры)``
# Задание
В данном задании вам необходимо будет скачать данные из S3. В интернете есть доступный для вас инстанс MiniO (S3). Куда вы можете сделать запрос. 

Сделайте запрос к таблице по такому URL http://158.160.116.58:9005/clickhouse/  (если вы работаете через инфроструктуру доступную на курсе, то подойдет такая ссылка http://minio:9000/clickhouse/....) в формате CSV с такой схемой данных ``currency String, value Int64, date String`` с такими ключами доступа ``student 12345678``

Если хотите посмотреть как лежат файлы в S3 можете это сделать по данному адресу http://158.160.116.58:9006, пароль и логин сверху

важное замечание в папке лежат данные из нескольких файлов с такой структурой 2021-01-0....csv (тут лежат числа между 1 и 10), вам это нужно учесть чтобы прочитать несколько файлов в одном запросе. Путь до файлов можно задать с помощью простых команд генерации, дополнительно почитайте про это в документации.

В качестве ответа укажите ```sum(value)```

#  Решение
```sql
CREATE TABLE default.s3_table (
  currency String, 
  value Int64, 
  date String
) 
ENGINE = S3('http://158.160.116.58:9005/clickhouse/2021-01-0*.csv', 'student', '12345678', 'CSV')
SETTINGS input_format_with_names_use_header = 0
 

select sum(value)
from default.s3_table 
```